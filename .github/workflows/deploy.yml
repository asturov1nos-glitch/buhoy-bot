name: Deploy to Yandex Cloud Container
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get Yandex Cloud IAM token
        id: token
        uses: docker://ghcr.io/yc-actions/yc-iam-token-fed:1.0.0
        with:
          yc-sa-id: ${{ secrets.YC_SA_ID }}

      - name: Deploy to Serverless Container
        uses: yc-actions/yc-sls-container-deploy@v4
        with:
          # === ОБЯЗАТЕЛЬНО ЗАМЕНИ ЭТИ ЗНАЧЕНИЯ ===
          # Имя контейнера в Yandex Cloud
          container-name: ${{ secrets.YC_CONTAINER_NAME }}
          # ID твоего каталога в Yandex Cloud
          folder-id: b1ggup1st10ftml9ku29  # <--- ЗАМЕНИ НА СВОЙ FOLDER-ID!
          # ID сервисного аккаунта с правами на контейнеры
          revision-service-account-id: ${{ secrets.YC_SA_ID }}
          
          # === НАСТРОЙКИ РЕСУРСОВ ===
          revision-memory: 512MB
          revision-cores: 1
          revision-execution-timeout: 30s
          revision-concurrency: 8
          
          # === ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ ДЛЯ БОТА ===
          revision-environment: |
            BOT_TOKEN=${{ secrets.BOT_TOKEN }}
            ADMIN_IDS=${{ secrets.ADMIN_IDS }}
            DB_HOST=localhost
            REDIS_HOST=localhost
            # PORT НЕ УКАЗЫВАЕМ - В YC ОН ВСЕГДА 8080
          
          # === ДОПОЛНИТЕЛЬНЫЕ ОПЦИИ ===
          # Раскомментируй для первого запуска (создаст контейнер если его нет)
          # create-if-not-exists: true