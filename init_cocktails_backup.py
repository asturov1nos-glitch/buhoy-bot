import asyncio
import sys
import os

# Добавляем путь к src
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from src.database import Database

async def init_database():
    # Примеры коктейлей для начального наполнения
    cocktails = [
        {
            "name": "Мохито",
            "description": "Освежающий кубинский коктейль с мятой и лаймом",
            "ingredients": {
                "белый ром": "50 мл",
                "свежая мята": "6-8 листиков",
                "лайм": "половинка",
                "сахарный сироп": "20 мл",
                "содовая": "100 мл",
                "лед": "дробленый"
            },
            "recipe": "1. В высокий бокал положите мяту и лайм\n2. Добавьте сахарный сироп и аккуратно подавите\n3. Наполните бокал дробленым льдом\n4. Добавьте ром и содовую\n5. Аккуратно перемешайте",
            "tags": ["освежающий", "летний", "мятный", "цитрусовый"],
            "strength": 15,
            "difficulty": "легко"
        },
        {
            "name": "Маргарита",
            "description": "Классический коктейль с текилой и лаймом",
            "ingredients": {
                "текила": "50 мл",
                "трипл сек": "20 мл",
                "лаймовый сок": "20 мл",
                "сахарный сироп": "10 мл",
                "лед": "кубики",
                "соль": "для ободка"
            },
            "recipe": "1. Обмакните край бокала в сок лайма и соль\n2. В шейкер со льдом добавьте все ингредиенты\n3. Взбейте и процедите в бокал\n4. Украсьте долькой лайма",
            "tags": ["классика", "текила", "цитрусовый", "соленый"],
            "strength": 25,
            "difficulty": "средне"
        },
        {
            "name": "Негрони",
            "description": "Итальянский аперитив с горьковатым вкусом",
            "ingredients": {
                "джин": "30 мл",
                "кампари": "30 мл",
                "красный вермут": "30 мл",
                "апельсин": "для украшения",
                "лед": "кубики"
            },
            "recipe": "1. Наполните бокал Old Fashioned льдом\n2. Добавьте все ингредиенты\n3. Аккуратно перемешайте барной ложкой\n4. Украсьте долькой апельсина",
            "tags": ["крепкий", "горький", "итальянский", "аперитив"],
            "strength": 28,
            "difficulty": "легко"
        },
        {
            "name": "Пина Колада",
            "description": "Сладкий тропический коктейль с кокосовым кремом",
            "ingredients": {
                "белый ром": "50 мл",
                "кокосовый крем": "30 мл",
                "ананасовый сок": "100 мл",
                "лед": "дробленый",
                "ананас": "для украшения"
            },
            "recipe": "1. В блендер добавьте все ингредиенты\n2. Взбейте до однородной консистенции\n3. Перелейте в высокий бокал\n4. Украсьте долькой ананаса",
            "tags": ["сладкий", "тропический", "кокосовый", "фруктовый"],
            "strength": 12,
            "difficulty": "легко"
        },
        {
            "name": "Олд Фэшн",
            "description": "Классический виски-коктейль",
            "ingredients": {
                "бурбон": "60 мл",
                "сахарный кубик": "1 шт",
                "ангостура биттер": "2-3 капли",
                "вода": "несколько капель",
                "лед": "кубики",
                "апельсиновая цедра": "для украшения"
            },
            "recipe": "1. Положите сахарный кубик в бокал\n2. Добавьте биттер и воду\n3. Растворите сахар\n4. Добавьте лед и виски\n5. Аккуратно перемешайте\n6. Украсьте цедрой апельсина",
            "tags": ["крепкий", "классика", "виски", "горький"],
            "strength": 35,
            "difficulty": "средне"
        }
    ]
    
    print("Начало наполнения базы данных...")
    
    for cocktail_data in cocktails:
        try:
            existing = await Database.get_cocktail_by_name(cocktail_data["name"])
            if existing:
                print(f"Коктейль '{cocktail_data['name']}' уже существует, пропускаем...")
                continue
                
            cocktail = await Database.add_cocktail(**cocktail_data)
            print(f"✅ Добавлен: {cocktail.name}")
        except Exception as e:
            print(f"❌ Ошибка при добавлении {cocktail_data['name']}: {e}")
    
    count = await Database.get_cocktails_count()
    print(f"\n✅ Готово! В базе {count} коктейлей")

if __name__ == "__main__":
    asyncio.run(init_database())
